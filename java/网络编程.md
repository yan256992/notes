## ðŸš ç½‘ç»œç¼–ç¨‹

**ç½‘ç»œç¼–ç¨‹åŸºç¡€**

- IPåœ°å€ï¼šè®¡ç®—æœºçš„ç½‘ç»œæŽ¥å£ï¼ˆé€šå¸¸æ˜¯ç½‘å¡ï¼‰åœ¨ç½‘ç»œä¸­çš„å”¯ä¸€æ ‡è¯†ï¼›
- ç½‘å…³ï¼šå¦‚æžœä¸¤ä¸ªè®¾å¤‡åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹é‚£ä¹ˆå¯ä»¥ç›´æŽ¥é€šä¿¡ï¼Œå¦åˆ™çš„å°±éœ€è¦ç½‘å…³æˆ–è€…è·¯ç”±å™¨è¿™æ ·çš„è®¾å¤‡ï¼Œå®ƒè´Ÿè´£è¿žæŽ¥å¤šä¸ªç½‘ç»œï¼Œå¹¶åœ¨å¤šä¸ªç½‘ç»œä¹‹é—´è½¬å‘æ•°æ®çš„è®¡ç®—æœºï¼Œé€šå¸¸æ˜¯è·¯ç”±å™¨æˆ–äº¤æ¢æœºï¼›
- ç½‘ç»œåè®®ï¼šäº’è”ç½‘ä½¿ç”¨TCP/IPåè®®ï¼Œå®ƒæ³›æŒ‡äº’è”ç½‘åè®®ç°‡ï¼›
- IPåè®®ï¼šä¸€ç§åˆ†ç»„äº¤æ¢ä¼ è¾“åè®®ï¼›
- TCPåè®®ï¼šä¸€ç§é¢å‘è¿žæŽ¥ï¼Œå¯é ä¼ è¾“çš„åè®®ï¼›
- UDPåè®®ï¼šä¸€ç§æ— è¿žæŽ¥ï¼Œä¸å¯é ä¼ è¾“çš„åè®®ã€‚

### TCPç¼–ç¨‹

**Socket**

Socketæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªSocketæ¥å»ºç«‹ä¸€ä¸ªè¿œç¨‹è¿žæŽ¥ï¼Œè€ŒSocketå†…éƒ¨é€šè¿‡TCP/IPåè®®æŠŠæ•°æ®ä¼ è¾“åˆ°ç½‘ç»œ

![image-20210906152803053](https://gitee.com/yan256992/cloudimages/raw/master/img/image-20210906152803053.png)

å¦‚æžœåªæœ‰Ipåœ°å€ï¼Œå®ƒæ²¡æ³•åˆ¤æ–­åº”è¯¥å‘é€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥ï¼Œæ“ä½œç³»ç»ŸæŠ½è±¡å‡ºSocketæŽ¥å£ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéœ€è¦å„è‡ªå¯¹åº”åˆ°ä¸åŒçš„Socketï¼Œæ•°æ®åŒ…æ‰èƒ½æ ¹æ®Socketæ­£ç¡®åœ°å‘é€åˆ°å¯¹åº”çš„åº”ç”¨ç¨‹åºã€‚

å¯ä»¥å°†Socketç®€å•çš„ç†è§£ä¸ºæ˜¯ipåœ°å€åŠ ä¸Šç«¯å£å·ã€‚

ä½¿ç”¨Socketè¿›è¡Œç½‘ç»œç¼–ç¨‹æ—¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„ç½‘ç»œé€šä¿¡ã€‚å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹å¿…é¡»å……å½“æœåŠ¡å™¨ç«¯ï¼Œå®ƒä¼šä¸»åŠ¨ç›‘å¬æŸä¸ªæŒ‡å®šçš„ç«¯å£ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å¿…é¡»å……å½“å®¢æˆ·ç«¯ï¼Œå®ƒå¿…é¡»ä¸»åŠ¨è¿žæŽ¥æœåŠ¡å™¨çš„IPåœ°å€å’ŒæŒ‡å®šç«¯å£ï¼Œå¦‚æžœè¿žæŽ¥æˆåŠŸï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å°±æˆåŠŸåœ°å»ºç«‹äº†ä¸€ä¸ªTCPè¿žæŽ¥ï¼ŒåŒæ–¹åŽç»­å°±å¯ä»¥éšæ—¶å‘é€å’ŒæŽ¥æ”¶æ•°æ®ã€‚

å› æ­¤ï¼Œå½“Socketè¿žæŽ¥æˆåŠŸåœ°åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹åŽï¼š

- å¯¹æœåŠ¡å™¨ç«¯æ¥è¯´ï¼Œå®ƒçš„Socketæ˜¯æŒ‡å®šçš„IPåœ°å€å’ŒæŒ‡å®šçš„ç«¯å£å·ï¼›
- å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒçš„Socketæ˜¯å®ƒæ‰€åœ¨è®¡ç®—æœºçš„IPåœ°å€å’Œä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„éšæœºç«¯å£å·ã€‚

æœåŠ¡ç«¯ï¼š

```java
public class Server {
    public static void main(String[] args) throws IOException {
        ServerSocket ss = new ServerSocket(6666); //ç›‘å¬æŒ‡å®šç«¯å£
        System.out.println("Server is running.....");
        for (;;){
            Socket socket = ss.accept();
            System.out.println("connected from "+socket.getRemoteSocketAddress()+"port"+socket.getPort());
            Thread t = new Handler(socket);
            t.start();
        }
    }
}
class Handler extends Thread{
    Socket socket;

    public Handler(Socket socket){
        this.socket = socket;
    }
    @Override
    public void run() {
        try {
            InputStream inputStream = this.socket.getInputStream();
            OutputStream outputStream = this.socket.getOutputStream();
            handle(inputStream,outputStream);
            this.socket.close();
            System.out.println("client disconnected.....");
        }catch (Exception e) {
            e.printStackTrace();
        }
    }
    private void handle(InputStream inputStream, OutputStream outputStream) throws IOException {
        BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(outputStream, StandardCharsets.UTF_8));
        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream, StandardCharsets.UTF_8));
        writer.write("hello\n");
        writer.flush();
        for (;;){
            String s = reader.readLine();
            if(s.equals("bye")){
                writer.write("bye\n");
                writer.flush();
                break;
            }
            writer.write("ok "+s+"\n");
            writer.flush();
        }
    }
}
```

å®¢æˆ·ç«¯ï¼š

```java
public class Client {
    public static void main(String[] args) throws IOException {
        Socket socket = new Socket("localhost",6666);
        InputStream inputStream = socket.getInputStream();
        OutputStream outputStream = socket.getOutputStream();
        handle(inputStream,outputStream);
        socket.close();
        System.out.println("disconnected......");
    }

    private static void handle(InputStream inputStream, OutputStream outputStream) throws IOException {
        BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(outputStream, StandardCharsets.UTF_8));
        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream, StandardCharsets.UTF_8));
        Scanner sc = new Scanner(System.in);
        System.out.println("[Server]"+reader.readLine());
        for(;;){
            System.out.println(">>>>>>>");
            String s = sc.nextLine();
            writer.write(s);
            writer.newLine();
            writer.flush();
            String resp = reader.readLine();
            System.out.println("<<<<<<<"+resp);
            if(resp.equals("bye")){
                break;
            }
        }
    }
}
```

Javaè¿›è¡ŒTCPç¼–ç¨‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨Socketæ¨¡åž‹ï¼š

- æœåŠ¡å™¨ç«¯ç”¨`ServerSocket`ç›‘å¬æŒ‡å®šç«¯å£ï¼›
- å®¢æˆ·ç«¯ä½¿ç”¨`Socket(InetAddress, port)`è¿žæŽ¥æœåŠ¡å™¨ï¼›
- æœåŠ¡å™¨ç«¯ç”¨`accept()`æŽ¥æ”¶è¿žæŽ¥å¹¶è¿”å›ž`Socket`ï¼›
- åŒæ–¹é€šè¿‡`Socket`æ‰“å¼€`InputStream`/`OutputStream`è¯»å†™æ•°æ®ï¼›
- æœåŠ¡å™¨ç«¯é€šå¸¸ä½¿ç”¨å¤šçº¿ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿žæŽ¥ï¼Œåˆ©ç”¨çº¿ç¨‹æ± å¯å¤§å¹…æå‡æ•ˆçŽ‡ï¼›
- `flush()`ç”¨äºŽå¼ºåˆ¶è¾“å‡ºç¼“å†²åŒºåˆ°ç½‘ç»œã€‚

